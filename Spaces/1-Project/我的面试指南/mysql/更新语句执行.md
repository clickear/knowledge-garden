---
date created: 2022-09-07
date modified: 2022-09-09
title: 更新语句执行
---

![|1375](http://image.clickear.top/updateprocess.png)

## :: 流程

1. 连接验证及解析、
2. 写[[undolog]]，记录数据被修改前的样子
3. 从索引中查找数据
4. 更新数据
    - 数据操作  
        4.1 数据页在内存中  
	        4.1.1 普通索引: 直接更新内存中的数据页  
	        4.1.2 唯一索引: 更新后是否会数据冲突,不会则更新  
        4.2 数据页不在内存中  
	        4.2.1 普通索引: 将对数据页的更新操作记录到change buffer，暂时不更新到磁盘。[[changebuffer]]会在空闲时异步更新到磁盘  
	        4.2.2 唯一索引: 因为需要保证更新后的唯一性，所以不能延迟更新，必须把数据页从磁盘加载到内存，然后判断更新后是否会数据冲突，不会的话就更新数据页
5. 写[[redolog]]（prepare状态）记录数据被修改后的样子 [[二阶段提交]]
6. 写[[binlog]]（同时将redo log设置为commit状态）记录整个操作过程
