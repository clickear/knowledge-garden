---
date created: 2022-09-07
date modified: 2023-03-08
title: æ›´æ–°è¯­å¥æ‰§è¡Œ
---

![|1375](http://image.clickear.top/updateprocess.png)

## :: æµç¨‹

1. è¿æ¥éªŒè¯åŠè§£æã€
2. å†™[[undolog]]ï¼Œè®°å½•æ•°æ®è¢«ä¿®æ”¹å‰çš„æ ·å­
3. ä»ç´¢å¼•ä¸­æŸ¥æ‰¾æ•°æ®
4. æ›´æ–°æ•°æ®
    - æ•°æ®æ“ä½œ  
        4.1 æ•°æ®é¡µåœ¨å†…å­˜ä¸­  
	        4.1.1 æ™®é€šç´¢å¼•: ç›´æ¥æ›´æ–°å†…å­˜ä¸­çš„æ•°æ®é¡µ  
	        4.1.2 å”¯ä¸€ç´¢å¼•: æ›´æ–°åæ˜¯å¦ä¼šæ•°æ®å†²çª,ä¸ä¼šåˆ™æ›´æ–°  
        4.2 æ•°æ®é¡µä¸åœ¨å†…å­˜ä¸­  
	        4.2.1 æ™®é€šç´¢å¼•: å°†å¯¹æ•°æ®é¡µçš„æ›´æ–°æ“ä½œè®°å½•åˆ°change bufferï¼Œæš‚æ—¶ä¸æ›´æ–°åˆ°ç£ç›˜ã€‚[[changebuffer]]ä¼šåœ¨ç©ºé—²æ—¶å¼‚æ­¥æ›´æ–°åˆ°ç£ç›˜  
	        4.2.2 å”¯ä¸€ç´¢å¼•: å› ä¸ºéœ€è¦ä¿è¯æ›´æ–°åçš„å”¯ä¸€æ€§ï¼Œæ‰€ä»¥ä¸èƒ½å»¶è¿Ÿæ›´æ–°ï¼Œå¿…é¡»æŠŠæ•°æ®é¡µä»ç£ç›˜åŠ è½½åˆ°å†…å­˜ï¼Œç„¶ååˆ¤æ–­æ›´æ–°åæ˜¯å¦ä¼šæ•°æ®å†²çªï¼Œä¸ä¼šçš„è¯å°±æ›´æ–°æ•°æ®é¡µ
5. å†™[[redolog]]ï¼ˆprepareçŠ¶æ€ï¼‰è®°å½•æ•°æ®è¢«ä¿®æ”¹åçš„æ ·å­ [[äºŒé˜¶æ®µæäº¤]]
6. å†™[[binlog]]ï¼ˆåŒæ—¶å°†redo logè®¾ç½®ä¸ºcommitçŠ¶æ€ï¼‰è®°å½•æ•´ä¸ªæ“ä½œè¿‡ç¨‹

## :: å¸¦[[changebuffer]]çš„æ›´æ–°è¿‡ç¨‹ [^1]

^897cc2

![](http://image.clickear.top/20230308104631.png)  
æˆ‘ä»¬å‡è®¾å½“å‰kç´¢å¼•æ ‘çš„çŠ¶æ€ï¼ŒæŸ¥æ‰¾åˆ°ä½ç½®åï¼Œk1æ‰€åœ¨çš„æ•°æ®é¡µåœ¨å†…å­˜(InnoDB buffer pool)ä¸­ï¼Œk2æ‰€åœ¨çš„æ•°æ®é¡µä¸åœ¨å†…å­˜ä¸­ã€‚

1. Page 1åœ¨å†…å­˜ä¸­ï¼Œç›´æ¥æ›´æ–°å†…å­˜ï¼›
2. Page 2æ²¡æœ‰åœ¨å†…å­˜ä¸­ï¼Œå°±åœ¨å†…å­˜çš„change bufferåŒºåŸŸï¼Œè®°å½•ä¸‹â€œæˆ‘è¦å¾€Page 2æ’å…¥ä¸€è¡Œâ€è¿™ä¸ªä¿¡æ¯
3. å°†ä¸Šè¿°ä¸¤ä¸ªåŠ¨ä½œè®°å…¥redo logä¸­ï¼ˆå›¾ä¸­3å’Œ4ï¼‰ã€‚  
æ‰§è¡Œè¿™æ¡æ›´æ–°è¯­å¥çš„æˆæœ¬å¾ˆä½ï¼Œå°±æ˜¯å†™äº†ä¸¤å¤„å†…å­˜(å¼‚æ­¥æŒä¹…åŒ–)ï¼Œç„¶åå†™äº†ä¸€å¤„ç£ç›˜ï¼ˆä¸¤æ¬¡æ“ä½œåˆåœ¨ä¸€èµ·å†™äº†ä¸€æ¬¡ç£ç›˜ï¼‰ï¼Œè€Œä¸”è¿˜æ˜¯é¡ºåºå†™çš„ã€‚
> [!TIP] æŠ€å·§ğŸ’¡  
> changebuffer, èŠ‚çœäº†**éšæœºè¯»ç£ç›˜çš„IOæ¶ˆè€—** ã€‚ä¸ç”¨è¿›è¡Œè¯»å–åˆ°å†…å­˜(buffer pool)ï¼Œåœ¨è¿›è¡Œå˜æ›´æ“ä½œï¼Œè€Œæ˜¯ç›´æ¥å†™åˆ°changebufferå†…å­˜  
> è¿™é‡Œä¹Ÿè§£é‡Šäº†ï¼Œä¸ºä»€ä¹ˆèƒ½é€šè¿‡redologæ¥æ‰¾å›changbufferçš„æ•°æ®ã€‚ä½¿ç”¨åˆ°äº†redologçš„äºŒé˜¶æ®µæäº¤ã€‚

[^1]: mysql45è®²ï¼Œ[mysql45è®²](https://book.clickear.top/mysql45/09%E8%AE%B2%E6%99%AE%E9%80%9A%E7%B4%A2%E5%BC%95%E5%92%8C%E5%94%AF%E4%B8%80%E7%B4%A2%E5%BC%95%EF%BC%8C%E5%BA%94%E8%AF%A5%E6%80%8E%E4%B9%88%E9%80%89%E6%8B%A9.html)
