---
date created: 2022-09-07
date modified: 2022-09-09
title: undolog
---

> [!TIP] undolog记录数据被修改前的样子💡  
> undolog的2大作用
> 1. 回滚功能
> 2. [[MVCC]]

## 回滚

> [!NOTE] 笔记  
> 当执行rollback时，就可以从undo log中的逻辑记录读取到相应的内容并进行回滚

+ undo log 主要为事务的**回滚服务**。在事务执行的过程中，除了记录[[redolog]]，还会记录一定量的[[undolog]]。undo log记录了数据在每个操作前的状态，如果事务执行过程中需要回滚，就可以根据undo log进行回滚操作。单个事务的回滚，只会回滚当前事务做的操作，并不会影响到其他的事务做的操作。
+ Undo记录的是**已部分完成并且写入硬盘的未完成**的事务，默认情况下回滚日志是记录下表空间中的（共享表空间或者独享表空间）

undo log主要是保证事务的原子性，事务执行失败就回滚，用于在事务执行失败后，对数据回滚。undo log是逻辑日志，记录的是SQL。（可以认为当delete一条记录时，undo log中会记录一条对应的insert记录，反之亦然，当update一条记录时，它记录一条对应相反的update记录。） 在事务提交后，undo log日志不会立即删除，会放到一个待删除的链表中，有purge线程判断是否有其他事务在使用上一个事务之前的版本信息，然后决定是否可以清理，简单的来说就是前面的事务都提交成功了，这些undo才能删除。

## MVCC

> [!NOTE] 笔记  
> 当读取的某一行被其他事务锁定时，它可以从undo log中分析出该行记录以前的数据是什么，从而提供该行版本信息，让用户实现非锁定一致性读取

## [[redolog和undolog的区别]]
