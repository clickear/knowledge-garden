


# 常青笔记
+ Multi-Paxos 思想，描述的是执行多个 Basic Paxos 实例，就**一系列值**达成共识。不关心最终达成共识的值是什么，不关心各值的顺序。这与[[ZAB]]是不一样的
+ 相比[[Paxos| basic paxos]] 优化思路是，引入[[领导者模型]]来优化。这样就省掉了多次rpc调用和活锁问题。优化 Basic Paxos 执行。


# 概念


## 优化
1. 引入 领导者模型，这样避免了活锁和多次rpc调用。领导者节点作为唯一提议者，这样就不存在多个提议者同时提交提案的情况，也就不存在提案冲突的情况了
2. 优化 Basic Paxos 执行，因为只有1个提案者，所以每次都是最新的。当主节点处于**稳定状态**时，就省掉准备阶段，直接进入接受阶段，所以在很大程度上减少了往返的消息数，提升了性能，降低了延迟

![multiPaxos 优化 Basic Paxos 执行](http://image.clickear.top/20220128142601.png)

## 过程
Multi Paxos 对 Basic Paxos 的核心改进是增加了“选主”的过程，提案节点会通过定时轮询（心跳），确定当前网络中的所有节点里是否存在有一个主提案节点，一旦没有发现主节点存在，节点就会在心跳超时后使用 Basic Paxos 中定义的准备、批准的两轮网络交互过程，向所有其他节点广播自己希望竞选主节点的请求，希望整个分布式系统对“由我作为主节点”这件事情协商达成一致共识，如果得到了决策节点中多数派的批准，便宣告竞选成功。当选主完成之后，除非主节点失联之后发起重新竞选，否则从此往后，就只有主节点本身才能够提出提案。此时，无论哪个提案节点接收到客户端的操作请求，都会将请求转发给主节点来完成提案，而主节点提案的时候，也就无需再次经过准备过程，因为可以视作是经过选举时的那一次准备之后，后续的提案都是对相同提案 ID 的一连串的批准过程。也可以通俗理解为选主过后，就不会再有其他节点与它竞争，相当于是处于无并发的环境当中进行的有序操作，所以此时系统中要对某个值达成一致，只需要进行一次批准的交互即可

![multi-paxos算法时序图](http://image.clickear.top/20220128160104.png)
这里新增了个任期的概念。

## 简化角色
![简化角色后](http://image.clickear.top/20220128160138.png)




# 资料
+ [multi-paxos](http://icyfenix.cn/distribution/consensus/raft.html)