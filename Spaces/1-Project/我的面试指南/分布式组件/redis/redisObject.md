---
title: redisObject
date created: 2023-10-13
date modified: 2023-11-08
---
> [!TIP] æŠ€å·§ğŸ’¡  
> [[redisObject]]æ€»å…±å ç”¨16byte

```
typedef struct redisObject {
    unsigned type:4; // 4 bit
    unsigned encoding:4; // 4 bit
    unsigned lru:LRU_BITS; // 3 ä¸ªå­—èŠ‚
    int refcount; // 4 ä¸ªå­—èŠ‚
    void *ptr; // 8 ä¸ªå­—èŠ‚
} robj;

```

- typeï¼šå¯¹è±¡çš„æ•°æ®ç±»å‹ï¼Œä¾‹å¦‚ï¼šstringã€listã€hash ç­‰ï¼Œå ç”¨ 4 bits ä¹Ÿå°±æ˜¯åŠä¸ªå­—ç¬¦çš„å¤§å°ï¼›
- encodingï¼šå¯¹è±¡æ•°æ®ç¼–ç ï¼Œå ç”¨ 4 bitsï¼›
- lruï¼šè®°å½•å¯¹è±¡çš„ LRU(Least Recently Used çš„ç¼©å†™ï¼Œå³æœ€è¿‘æœ€å°‘ä½¿ç”¨)ä¿¡æ¯ï¼Œå†…å­˜å›æ”¶æ—¶ä¼šç”¨åˆ°æ­¤å±æ€§ï¼Œå ç”¨ 24 bits(3 å­—èŠ‚)ï¼›
- refcountï¼šå¼•ç”¨è®¡æ•°å™¨ï¼Œå ç”¨ 32 bits(4 å­—èŠ‚)ï¼›
- *ptrï¼šå¯¹è±¡æŒ‡é’ˆç”¨äºæŒ‡å‘å…·ä½“çš„å†…å®¹ï¼Œå ç”¨ 64 bits(8 å­—èŠ‚)ã€‚

### lruå­—æ®µ

**åœ¨ [[redis-lru]]ç®—æ³•ä¸­**ï¼ŒRedis å¯¹è±¡å¤´çš„ 24 bits çš„ lru å­—æ®µæ˜¯ç”¨æ¥è®°å½• key çš„è®¿é—®æ—¶é—´æˆ³ï¼Œå› æ­¤åœ¨ LRU æ¨¡å¼ä¸‹ï¼ŒRediså¯ä»¥æ ¹æ®å¯¹è±¡å¤´ä¸­çš„ lru å­—æ®µè®°å½•çš„å€¼ï¼Œæ¥æ¯”è¾ƒæœ€åä¸€æ¬¡ key çš„è®¿é—®æ—¶é—´é•¿ï¼Œä»è€Œæ·˜æ±°æœ€ä¹…æœªè¢«ä½¿ç”¨çš„ keyã€‚

**åœ¨ [[redis-lfu]]ç®—æ³•ä¸­**ï¼ŒRediså¯¹è±¡å¤´çš„ 24 bits çš„ lru å­—æ®µè¢«åˆ†æˆä¸¤æ®µæ¥å­˜å‚¨ï¼Œé«˜ 16bit å­˜å‚¨ ldt(Last Decrement Time)ï¼Œä½ 8bit å­˜å‚¨ logc(Logistic Counter)ã€‚

![](https://cdn.xiaolincoding.com/gh/xiaolincoder/redis/%E8%BF%87%E6%9C%9F%E7%AD%96%E7%95%A5/lru%E5%AD%97%E6%AE%B5.png)

- ldt æ˜¯ç”¨æ¥è®°å½• key çš„è®¿é—®æ—¶é—´æˆ³ï¼›
- logc æ˜¯ç”¨æ¥è®°å½• key çš„è®¿é—®é¢‘æ¬¡ï¼Œå®ƒçš„å€¼è¶Šå°è¡¨ç¤ºä½¿ç”¨é¢‘ç‡è¶Šä½ï¼Œè¶Šå®¹æ˜“æ·˜æ±°ï¼Œæ¯ä¸ªæ–°åŠ å…¥çš„ key çš„logc åˆå§‹å€¼ä¸º 5ã€‚

æ³¨æ„ï¼Œlogc å¹¶ä¸æ˜¯å•çº¯çš„è®¿é—®æ¬¡æ•°ï¼Œè€Œæ˜¯è®¿é—®é¢‘æ¬¡ï¼ˆè®¿é—®é¢‘ç‡ï¼‰ï¼Œå› ä¸ºÂ **logc ä¼šéšæ—¶é—´æ¨ç§»è€Œè¡°å‡çš„**
