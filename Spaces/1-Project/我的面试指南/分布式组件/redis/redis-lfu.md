---
title: redis-lfu
date created: 2023-11-08
date modified: 2023-11-08
---
> [!TIP] Redis 在访问 key 时，对于 logc 是这样变化的💡  
> lfu，不是基于基于访问次数来的，而是基于访问频次，会**随时间推移而衰减的**。
> 1. 先按照上次访问距离当前的时长，来对 logc 进行衰减；
> 2. 然后，再按照一定概率增加 logc 的值

LFU 算法相比于 LRU 算法的实现，多记录了「数据的访问频次」的信息.  
在[[redisObject]]中，会记录每个对象的lru字段，分成2部分(key的最后方位时间戳、访问频次)

- ldt 是用来记录 key 的访问时间戳；
- logc 是用来记录 key 的访问频次，它的值越小表示使用频率越低，越容易淘汰，每个新加入的 key 的logc 初始值为 5。

在每次 key 被访问时，会先对 logc 做一个衰减操作，衰减的值跟前后访问时间的差距有关系，如果上一次访问的时间与这一次访问的时间差距很大，那么衰减的值就越大，这样实现的 LFU 算法是根据**访问频率**来淘汰数据的，而不只是访问次数。访问频率需要考虑 key 的访问是多长时间段内发生的。key 的先前访问距离当前时间越长，那么这个 key 的访问频率相应地也就会降低，这样被淘汰的概率也会更大。

对 logc 做完衰减操作后，就开始对 logc 进行增加操作，增加操作并不是单纯的 + 1，而是根据概率增加，如果 logc 越大的 key，它的 logc 就越难再增加。

## 资料

[Redis 过期删除策略和内存淘汰策略有什么区别？ | 小林coding](https://xiaolincoding.com/redis/module/strategy.html#lru-%E7%AE%97%E6%B3%95%E5%92%8C-lfu-%E7%AE%97%E6%B3%95%E6%9C%89%E4%BB%80%E4%B9%88%E5%8C%BA%E5%88%AB)
